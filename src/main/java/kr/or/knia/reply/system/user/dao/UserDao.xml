<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.knia.reply.system.user.dao.UserDao">
	<select id="getUserById" resultType="User">
     SELECT ID,
     		PIN,
            NAME,
            MOBILE,
            GRADE,
            GRP AS "GROUP",
            (  SELECT NAME
                 FROM REPLY_CODE
                WHERE CD = A.GRP ) AS GROUP_NAME
       FROM REPLY_USER A
      WHERE ID = #{id}
	</select>

	<select id="getUser" resultType="User">
    SELECT *
      FROM (  SELECT A.*,
                     GRP AS "GROUP",
                     (  SELECT NAME
                          FROM REPLY_CODE
                         WHERE CD = A.GRP ) AS GROUP_NAME
                FROM REPLY_USER A )
     WHERE GRP = DECODE(#{group}, 'N00', GRP, #{group})
      <if test='keyword != null and keyword != ""'>
      <choose>
        <when test='searchBy == "ALL"'>
           ( ID LIKE '%'|| #{keyword} ||'%'
           OR NAME LIKE '%'|| #{keyword} ||'%'
           OR GROUP_NAME LIKE '%'|| #{keyword} ||'%' )
         </when>
        <when test='searchBy == "ID"'> ID LIKE '%'|| #{keyword} ||'%'</when>
        <when test='searchBy == "NAME"'> NAME LIKE '%'|| #{keyword} ||'%'</when>
        <when test='searchBy == "GROUP"'> GROUP_NAME LIKE '%'|| #{keyword} ||'%'</when>
      </choose>
      </if>
	</select>
	
	<update id="save">
    MERGE
     INTO REPLY_USER
    USING ( SELECT 1 FROM DUAL )
       ON ( ID = #{id} )
     WHEN MATCHED THEN
   UPDATE
      SET NAME = #{name},
          PIN = NVL(#{pin}, PIN),
          GRP = #{group},
          MOBILE = #{mobile},
          GRADE = #{grade}
     WHEN NOT MATCHED THEN
   INSERT (ID, PIN, NAME, GRP, MOBILE, GRADE)
   VALUES (#{id}, #{pin}, #{name}, #{group}, #{mobile}, #{grade})
	</update>
	
	<delete id="remove">
    DELETE
      FROM REPLY_USER
     WHERE ID = #{id}
	</delete>
	
	<select id="getCorps" resultType="Map">
    SELECT *
      FROM REPLY_CODE
     WHERE PCD = 'CORPS'
  ORDER BY CD
	</select>
</mapper>